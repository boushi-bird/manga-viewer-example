var S=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var i=(a,e,t)=>(S(a,e,"read from private field"),t?t.call(a):e.get(a)),l=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},d=(a,e,t,n)=>(S(a,e,"write to private field"),n?n.call(a,t):e.set(a,t),t);const T=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};T();async function M(){const a=await fetch("./data.json");if(!a.ok)return console.error("api error!"),Promise.reject();const{page_images:e}=await a.json();return e}var y,g,w,x;class R{constructor(e){l(this,y,!1);l(this,g,void 0);l(this,w,void 0);l(this,x,void 0);d(this,g,e),d(this,w,this.createElement()),d(this,x,this.createCanvas(e.width,e.height)),i(this,w).appendChild(i(this,x))}get index(){return i(this,g).index}get element(){return i(this,w)}createElement(){const e=document.createElement("p");return e.classList.add("viewer-page"),e}createCanvas(e,t){const n=document.createElement("canvas");return n.classList.add("content"),n.setAttribute("width",`${e}`),n.setAttribute("height",`${t}`),n}loadImage(){if(i(this,y))return Promise.resolve();const e=i(this,x).getContext("2d");if(!e)return console.error("The rendering context is not ready."),Promise.reject();d(this,y,!0);const t=new Image;return t.src=typeof i(this,g).image=="string"?i(this,g).image:i(this,g).image.url,new Promise((n,s)=>{t.onload=()=>{this.drawPageImage(e,t),n()},t.onabort=t.onerror=s})}drawPageImage(e,t){const{width:n,height:s,image:r}=i(this,g),c=typeof r=="string"?{w:t.width,h:t.height,pieces:void 0}:r,o=n/s,h=c.w/c.h,m=o>h?h*s:n,A=o>h?s:n/h,$=(n-m)/2,z=(s-A)/2;if(c.pieces){const F=m/c.w,O=A/c.h;for(const p of c.pieces)e.drawImage(t,p.x,p.y,p.w,p.h,$+p.dx*F,z+p.dy*O,p.w*F,p.h*O)}else e.drawImage(t,$,z,m,A)}}y=new WeakMap,g=new WeakMap,w=new WeakMap,x=new WeakMap;const j=800,k=1200;var v,L,I,u,C,f,E,P,b;class H{constructor({pageImages:e,mode:t}){l(this,v,void 0);l(this,L,void 0);l(this,I,void 0);l(this,u,[]);l(this,C,void 0);l(this,f,[]);l(this,E,void 0);l(this,P,[]);l(this,b,!1);d(this,C,t);const{viewer:n,pageContents:s,pageSelector:r}=this.createElements(t);d(this,v,n),d(this,L,s),d(this,I,r),d(this,u,this.createPages(s,e)),r.setAttribute("max",`${i(this,u).length-1}`),this.setupCurrentIndexChange();for(const c of i(this,u))c.loadImage()}get element(){return i(this,v)}get pages(){return i(this,u)}set currentIndex(e){const t=i(this,u).find(n=>n.index===e);!t||t.element.scrollIntoView()}get currentIndex(){return i(this,f).length===0?0:Math.min(...i(this,f))}next(){this.currentIndex+=i(this,f).length}prev(){this.currentIndex-=i(this,f).length}right(){i(this,C)==="horizontal-rtl"?this.prev():this.next()}left(){i(this,C)==="horizontal-rtl"?this.next():this.prev()}canFullscreen(){return!!i(this,v).requestFullscreen}async fullscreen(){this.canFullscreen()&&await i(this,v).requestFullscreen()}onCurrentIndexChanged(e){i(this,P).push(e)}emitCurrentIndexChanged(e){d(this,f,e),i(this,I).value=`${this.currentIndex}`,i(this,I).setAttribute("step",`${e.length}`);for(const t of i(this,P))t(this.currentIndex)}pendEmitCurrentIndexChanged(e){i(this,b)||this.emitCurrentIndexChanged(e),d(this,E,e)}setupCurrentIndexChange(){const e=new Set,t=new IntersectionObserver(n=>{for(const s of n){const r=i(this,u).find(c=>c.element===s.target);!r||(s.isIntersecting?e.add(r.index):e.delete(r.index))}this.pendEmitCurrentIndexChanged([...e])},{root:i(this,L),threshold:.6});for(const n of i(this,u))t.observe(n.element)}createElements(e){const t=document.createElement("section");t.classList.add("manga-viewer");const n=t.appendChild(document.createElement("div"));n.classList.add("viewer-main");const s=n.appendChild(document.createElement("div"));s.classList.add("viewer-page-contents"),e.startsWith("horizontal-")?(t.classList.add("horizontal-viewer"),t.classList.add(e==="horizontal-rtl"?"rtl-contents":"ltr-contents")):t.classList.add(`${e}-viewer`);const r=document.createElement("input");n.appendChild(r),r.classList.add("page-selector"),r.setAttribute("type","range"),r.setAttribute("min","0"),r.setAttribute("max","0"),r.setAttribute("value","0"),r.setAttribute("step","1"),r.addEventListener("change",()=>{const o=Math.round(parseFloat(r.value));this.currentIndex=o});let c;return s.addEventListener("scroll",()=>{window.clearTimeout(c),d(this,b,!0),c=window.setTimeout(()=>{const o=i(this,E);d(this,b,!1),d(this,E,void 0),o!=null&&this.emitCurrentIndexChanged(o)},100)}),{viewer:t,pageContents:s,pageSelector:r}}createPages(e,t){const n=t.map((r,c)=>{const o=new R({width:j,height:k,index:c,image:r});return e.appendChild(o.element),o}),s=document.createElement("p");return s.classList.add("empty-page"),e.appendChild(s),n}}v=new WeakMap,L=new WeakMap,I=new WeakMap,u=new WeakMap,C=new WeakMap,f=new WeakMap,E=new WeakMap,P=new WeakMap,b=new WeakMap;window.addEventListener("DOMContentLoaded",async()=>{var r,c;const a=document.getElementById("embed");if(!a){console.error("element not found");return}const e=await M(),t=new H({pageImages:e,mode:"horizontal-rtl"});a.appendChild(t.element);const n=document.createElement("select");for(let o=0;o<t.pages.length;o++){const h=document.createElement("option"),m=`${o+1}`;h.setAttribute("value",m),h.innerText=m,n.appendChild(h)}if(n.addEventListener("change",()=>{const o=parseInt(n.value)-1;t.currentIndex=o}),t.onCurrentIndexChanged(o=>{n.value=`${o+1}`}),document.body.appendChild(n),(r=document.getElementById("simple-next"))==null||r.addEventListener("click",()=>{t.left()}),(c=document.getElementById("simple-prev"))==null||c.addEventListener("click",()=>{t.right()}),new ResizeObserver(o=>{const h=o.find(m=>m.target===t.element);!h||console.log(h.contentRect.width,h.contentRect.height)}).observe(t.element),t.canFullscreen()){const o=document.createElement("button");o.setAttribute("type","button"),o.innerText="full",o.addEventListener("click",()=>{t.fullscreen()}),document.body.append(o)}});console.debug("run");
