var T=(c,e,t)=>{if(!e.has(c))throw TypeError("Cannot "+t)};var i=(c,e,t)=>(T(c,e,"read from private field"),t?t.call(c):e.get(c)),l=(c,e,t)=>{if(e.has(c))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(c):e.set(c,t)},d=(c,e,t,n)=>(T(c,e,"write to private field"),n?n.call(c,t):e.set(c,t),t);const $=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}};$();async function M(){const c=await fetch("./data.json");if(!c.ok)return console.error("api error!"),Promise.reject();const{page_images:e}=await c.json();return e}var b,g,w,I;class B{constructor(e){l(this,b,!1);l(this,g,void 0);l(this,w,void 0);l(this,I,void 0);d(this,g,e),d(this,w,this.createElement()),d(this,I,this.createCanvas(e.width,e.height)),i(this,w).appendChild(i(this,I))}get index(){return i(this,g).index}get element(){return i(this,w)}createElement(){const e=document.createElement("p");return e.classList.add("viewer-page"),e}createCanvas(e,t){const n=document.createElement("canvas");return n.classList.add("content"),n.setAttribute("width",`${e}`),n.setAttribute("height",`${t}`),n}loadImage(){if(i(this,b))return Promise.resolve();const e=i(this,I).getContext("2d");if(!e)return console.error("The rendering context is not ready."),Promise.reject();d(this,b,!0);const t=new Image;return t.src=typeof i(this,g).image=="string"?i(this,g).image:i(this,g).image.url,new Promise((n,r)=>{t.onload=()=>{this.drawPageImage(e,t),n()},t.onabort=t.onerror=r})}drawPageImage(e,t){const{width:n,height:r,image:s}=i(this,g),a=typeof s=="string"?{w:t.width,h:t.height,pieces:void 0}:s,o=n/r,h=a.w/a.h,m=o>h?h*r:n,A=o>h?r:n/h,z=(n-m)/2,F=(r-A)/2;if(a.pieces){const O=m/a.w,S=A/a.h;for(const p of a.pieces)e.drawImage(t,p.x,p.y,p.w,p.h,z+p.dx*O,F+p.dy*S,p.w*O,p.h*S)}else e.drawImage(t,z,F,m,A)}}b=new WeakMap,g=new WeakMap,w=new WeakMap,I=new WeakMap;const R=800,j=1200;var f,v,L,u,x,C,y,P,E;class k{constructor({pageImages:e,mode:t}){l(this,f,void 0);l(this,v,void 0);l(this,L,void 0);l(this,u,[]);l(this,x,void 0);l(this,C,0);l(this,y,void 0);l(this,P,[]);l(this,E,!1);d(this,x,t);const{viewer:n,pageContents:r,pageSelector:s}=this.createElements(t);d(this,f,n),d(this,v,r),d(this,L,s),d(this,u,this.createPages(r,e)),s.setAttribute("max",`${i(this,u).length-1}`),this.setupCurrentIndexChange();for(const a of i(this,u))a.loadImage()}get element(){return i(this,f)}get pages(){return i(this,u)}set currentIndex(e){const t=i(this,u).find(n=>n.index===e);!t||t.element.scrollIntoView()}get currentIndex(){return i(this,C)}next(){i(this,x)==="horizontal-rtl"?this.right():this.left()}prev(){i(this,x)==="horizontal-rtl"?this.left():this.right()}right(){i(this,v).scrollBy({left:-1})}left(){i(this,v).scrollBy({left:1})}canFullscreen(){return!!i(this,f).requestFullscreen}async fullscreen(){this.canFullscreen()&&await i(this,f).requestFullscreen()}onCurrentIndexChanged(e){i(this,P).push(e)}emitCurrentIndexChanged(e){d(this,C,e),i(this,L).value=`${e}`;for(const t of i(this,P))t(e)}pendEmitCurrentIndexChanged(e){i(this,E)||this.emitCurrentIndexChanged(e),d(this,y,e)}setupCurrentIndexChange(){const e=new Set,t=new IntersectionObserver(n=>{for(const s of n){const a=i(this,u).find(o=>o.element===s.target);!a||(s.isIntersecting?e.add(a.index):e.delete(a.index))}if(e.size===0)return;const r=Math.min(...e);r!==i(this,C)&&this.pendEmitCurrentIndexChanged(r)},{root:i(this,v),threshold:0});for(const n of i(this,u))t.observe(n.element);this.emitCurrentIndexChanged(0)}createElements(e){const t=document.createElement("section");t.classList.add("manga-viewer");const n=t.appendChild(document.createElement("div"));n.classList.add("viewer-main");const r=n.appendChild(document.createElement("div"));r.classList.add("viewer-page-contents"),e.startsWith("horizontal-")?(t.classList.add("horizontal-viewer"),t.classList.add(e==="horizontal-rtl"?"rtl-contents":"ltr-contents")):t.classList.add(`${e}-viewer`);const s=document.createElement("input");n.appendChild(s),s.classList.add("page-selector"),s.setAttribute("type","range"),s.setAttribute("min","0"),s.setAttribute("max","0"),s.setAttribute("value","0"),s.setAttribute("step","1"),s.addEventListener("change",()=>{const o=Math.round(parseFloat(s.value));this.currentIndex=o});let a;return r.addEventListener("scroll",()=>{clearTimeout(a),d(this,E,!0),a=window.setTimeout(()=>{const o=i(this,y);d(this,E,!1),d(this,y,void 0),o!=null&&this.emitCurrentIndexChanged(o)},100)}),{viewer:t,pageContents:r,pageSelector:s}}createPages(e,t){const n=t.map((s,a)=>{const o=new B({width:R,height:j,index:a,image:s});return e.appendChild(o.element),o}),r=document.createElement("p");return r.classList.add("empty-page"),e.appendChild(r),n}}f=new WeakMap,v=new WeakMap,L=new WeakMap,u=new WeakMap,x=new WeakMap,C=new WeakMap,y=new WeakMap,P=new WeakMap,E=new WeakMap;window.addEventListener("DOMContentLoaded",async()=>{var s,a;const c=document.getElementById("embed");if(!c){console.error("element not found");return}const e=await M(),t=new k({pageImages:e,mode:"horizontal-rtl"});c.appendChild(t.element);const n=document.createElement("select");for(let o=0;o<t.pages.length;o++){const h=document.createElement("option"),m=`${o+1}`;h.setAttribute("value",m),h.innerText=m,n.appendChild(h)}if(n.addEventListener("change",()=>{const o=parseInt(n.value)-1;t.currentIndex=o}),t.onCurrentIndexChanged(o=>{n.value=`${o+1}`}),document.body.appendChild(n),(s=document.getElementById("simple-next"))==null||s.addEventListener("click",()=>{t.next()}),(a=document.getElementById("simple-prev"))==null||a.addEventListener("click",()=>{t.prev()}),new ResizeObserver(o=>{const h=o.find(m=>m.target===t.element);!h||console.log(h.contentRect.width,h.contentRect.height)}).observe(t.element),t.canFullscreen()){const o=document.createElement("button");o.setAttribute("type","button"),o.innerText="full",o.addEventListener("click",()=>{t.fullscreen()}),document.body.append(o)}});console.debug("run");
